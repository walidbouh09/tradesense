# ============================================================================
# TradeSense AI - Docker Environment Configuration
# ============================================================================
# This file contains environment variables optimized for Docker deployment
# Copy this to .env and modify values as needed for your deployment
# ============================================================================

# ============================================================================
# APPLICATION CONFIGURATION
# ============================================================================
APP_NAME=tradesense-ai
APP_VERSION=1.0.0
ENVIRONMENT=production
DEBUG=false
LOG_LEVEL=INFO

# ============================================================================
# SECURITY CONFIGURATION
# ============================================================================
# Generate secure keys with: python -c "import secrets; print(secrets.token_urlsafe(32))"
SECRET_KEY=your-super-secret-key-change-in-production-min-32-chars-docker
JWT_SECRET_KEY=jwt-secret-key-change-in-production-min-32-chars-docker
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# ============================================================================
# DATABASE CONFIGURATION (PostgreSQL)
# ============================================================================
# Docker service names are used as hostnames
DB_HOST=postgres
DB_PORT=5432
DB_USERNAME=tradesense_user
DB_PASSWORD=tradesense_secure_pass_2024
DB_DATABASE=tradesense
DB_POOL_SIZE=20
DB_POOL_OVERFLOW=30
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600

# Full database URL for SQLAlchemy
DATABASE_URL=postgresql+asyncpg://tradesense_user:tradesense_secure_pass_2024@postgres:5432/tradesense

# PostgreSQL Docker specific settings
POSTGRES_USER=tradesense_user
POSTGRES_PASSWORD=tradesense_secure_pass_2024
POSTGRES_DB=tradesense
POSTGRES_PORT=5432
POSTGRES_INITDB_ARGS=--encoding=UTF-8 --lc-collate=C --lc-ctype=C

# ============================================================================
# REDIS CONFIGURATION
# ============================================================================
# Docker service names are used as hostnames
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=tradesense_redis_secure_2024
REDIS_DB=0
REDIS_POOL_SIZE=10
REDIS_SOCKET_TIMEOUT=5
REDIS_SOCKET_CONNECT_TIMEOUT=5
REDIS_RETRY_ON_TIMEOUT=true
REDIS_HEALTH_CHECK_INTERVAL=30

# Redis Docker specific settings
REDIS_MAXMEMORY=512mb
REDIS_MAXMEMORY_POLICY=allkeys-lru

# ============================================================================
# FASTAPI/UVICORN CONFIGURATION
# ============================================================================
HOST=0.0.0.0
PORT=8000
WORKERS=1
RELOAD=false
ACCESS_LOG=true
LOG_CONFIG=

# ASGI server settings for Docker
UVICORN_HOST=0.0.0.0
UVICORN_PORT=8000
UVICORN_WORKERS=1
UVICORN_LOG_LEVEL=info
UVICORN_ACCESS_LOG=true
UVICORN_RELOAD=false

# ============================================================================
# CORS CONFIGURATION
# ============================================================================
# Allow frontend and nginx to connect
CORS_ORIGINS=http://localhost:3000,http://localhost:80,http://frontend:80,http://nginx:80
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=GET,POST,PUT,DELETE,OPTIONS,PATCH
CORS_ALLOW_HEADERS=*

# ============================================================================
# DOCKER SERVICE PORTS
# ============================================================================
BACKEND_PORT=8000
FRONTEND_PORT=3000
POSTGRES_EXTERNAL_PORT=5432
REDIS_EXTERNAL_PORT=6379
NGINX_PORT=80
NGINX_HTTPS_PORT=443

# ============================================================================
# PAYMENT SIMULATION CONFIGURATION
# ============================================================================
# All payment processing is SIMULATED - NO REAL MONEY
PAYMENT_SIMULATION_MODE=true
PAYMENT_SIMULATION_DELAY=2

# CMI (Moroccan Payment Gateway) - SIMULATED
CMI_MERCHANT_ID=test_merchant_123
CMI_SECRET_KEY=test_secret_key_456
CMI_GATEWAY_URL=https://testpayment.cmi.co.ma/fim/est3Dgate
CMI_SUCCESS_URL=http://localhost:3000/payment/success
CMI_FAIL_URL=http://localhost:3000/payment/failed

# Crypto Payment Simulation
CRYPTO_SIMULATION_ENABLED=true
BTC_WALLET_ADDRESS=1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2
ETH_WALLET_ADDRESS=0x742d35Cc6634C0532925a3b8D4c2031EE7a0c0123
USDT_WALLET_ADDRESS=0x742d35Cc6634C0532925a3b8D4c2031EE7a0c4567

# PayPal Integration - SIMULATED
PAYPAL_MODE=sandbox
PAYPAL_CLIENT_ID=test_client_id_sandbox
PAYPAL_CLIENT_SECRET=test_client_secret_sandbox
PAYPAL_WEBHOOK_ID=test_webhook_id

# Stripe Integration - SIMULATED
STRIPE_API_KEY=sk_test_placeholder_for_simulation
STRIPE_WEBHOOK_SECRET=whsec_placeholder_for_simulation
STRIPE_PUBLISHABLE_KEY=pk_test_placeholder_for_simulation

# ============================================================================
# MARKET DATA CONFIGURATION
# ============================================================================
# Morocco Market Integration (Casablanca Stock Exchange)
MOROCCO_MARKET_ENABLED=true
MOROCCO_MARKET_CACHE_TTL=300
MOROCCO_MARKET_RATE_LIMIT=1
MOROCCO_MARKET_TIMEOUT=10
MOROCCO_MARKET_BASE_URL=https://www.casablanca-bourse.com

# International Market Data
MARKET_DATA_PROVIDER=yfinance
MARKET_DATA_CACHE_TTL=60
MARKET_DATA_RATE_LIMIT=0.5

# ============================================================================
# WORKER CONFIGURATION
# ============================================================================
# Audit Writer Worker
AUDIT_WRITER_ENABLED=true
AUDIT_WRITER_BATCH_SIZE=100
AUDIT_WRITER_FLUSH_INTERVAL=30

# Payment Processor Worker
PAYMENT_PROCESSOR_ENABLED=true
PAYMENT_PROCESSOR_INTERVAL=10
PAYMENT_PROCESSOR_TIMEOUT=30

# Risk Monitoring Worker
RISK_MONITOR_ENABLED=true
RISK_MONITOR_INTERVAL=60
RISK_MONITOR_THRESHOLD_MINUTES=30

# Background Task Settings
CELERY_BROKER_URL=redis://redis:6379/1
CELERY_RESULT_BACKEND=redis://redis:6379/1
CELERY_TASK_SERIALIZER=json
CELERY_RESULT_SERIALIZER=json
CELERY_ACCEPT_CONTENT=json
CELERY_TIMEZONE=UTC

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================
LOG_FORMAT=%(asctime)s - %(name)s - %(levelname)s - %(message)s
LOG_DATE_FORMAT=%Y-%m-%d %H:%M:%S
LOG_FILE_MAX_SIZE=10MB
LOG_FILE_BACKUP_COUNT=5
LOG_TO_FILE=true
LOG_TO_CONSOLE=true

# Structured logging for production
STRUCTURED_LOGGING=true
LOG_JSON_FORMAT=true

# Application-specific logging
TRADESENSE_LOG_LEVEL=INFO
SQLALCHEMY_LOG_LEVEL=WARNING
UVICORN_LOG_LEVEL=INFO
REDIS_LOG_LEVEL=WARNING

# ============================================================================
# HEALTH CHECK CONFIGURATION
# ============================================================================
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_INTERVAL=30
HEALTH_CHECK_TIMEOUT=10
HEALTH_CHECK_RETRIES=3

# Service health check URLs (internal Docker network)
POSTGRES_HEALTH_CHECK=pg_isready -U tradesense_user -d tradesense
REDIS_HEALTH_CHECK=redis-cli -a tradesense_redis_secure_2024 ping
BACKEND_HEALTH_CHECK=http://localhost:8000/health
FRONTEND_HEALTH_CHECK=http://localhost:80

# ============================================================================
# MONITORING & METRICS
# ============================================================================
METRICS_ENABLED=true
PROMETHEUS_METRICS=false
GRAFANA_ENABLED=false

# Performance monitoring
REQUEST_TIMEOUT=30
MAX_REQUEST_SIZE=10MB
MAX_CONCURRENT_REQUESTS=100

# ============================================================================
# BUSINESS LOGIC CONFIGURATION
# ============================================================================
# Challenge Configuration
DEFAULT_CHALLENGE_BALANCE=10000.00
CHALLENGE_CURRENCY=USD
CHALLENGE_TIMEOUT_DAYS=30

# Risk Management
MAX_DAILY_DRAWDOWN_PERCENT=5.0
MAX_TOTAL_DRAWDOWN_PERCENT=10.0
PROFIT_TARGET_PERCENT=10.0
MAX_POSITION_SIZE_PERCENT=20.0

# Pricing Tiers (in MAD - Moroccan Dirham)
STARTER_TIER_PRICE=200.00
PRO_TIER_PRICE=500.00
ELITE_TIER_PRICE=1000.00

# Currency Exchange (for simulation)
MAD_TO_USD_RATE=0.10
BTC_TO_USD_RATE=45000.00
ETH_TO_USD_RATE=2500.00
USDT_TO_USD_RATE=1.00

# ============================================================================
# DOCKER COMPOSE OVERRIDES
# ============================================================================
# These variables are used by docker-compose.yml

# Build configuration
DOCKER_BUILDKIT=1
COMPOSE_DOCKER_CLI_BUILD=1

# Resource limits
POSTGRES_MEMORY_LIMIT=512m
REDIS_MEMORY_LIMIT=256m
BACKEND_MEMORY_LIMIT=1024m
FRONTEND_MEMORY_LIMIT=512m

# Restart policies
RESTART_POLICY=unless-stopped

# Volume configuration
POSTGRES_DATA_VOLUME=postgres_data
REDIS_DATA_VOLUME=redis_data
LOG_VOLUME=./logs

# Network configuration
NETWORK_NAME=tradesense_network
NETWORK_SUBNET=172.20.0.0/16

# ============================================================================
# DEVELOPMENT OVERRIDES
# ============================================================================
# Set these to true for development mode
DEV_MODE=false
DEV_RELOAD=false
DEV_DEBUG=false

# Development database (for local testing)
DEV_DB_HOST=localhost
DEV_DB_PORT=5432
DEV_REDIS_HOST=localhost
DEV_REDIS_PORT=6379

# ============================================================================
# PRODUCTION SECURITY SETTINGS
# ============================================================================
# HTTPS/SSL Configuration
SSL_ENABLED=false
SSL_CERT_PATH=/etc/ssl/certs/tradesense.crt
SSL_KEY_PATH=/etc/ssl/private/tradesense.key

# Rate limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS_PER_MINUTE=100
RATE_LIMIT_BURST=20

# Session configuration
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SAMESITE=Lax
SESSION_COOKIE_MAX_AGE=86400

# ============================================================================
# FEATURE FLAGS
# ============================================================================
FEATURE_PAYMENT_SIMULATION=true
FEATURE_MOROCCO_MARKET=true
FEATURE_WEBSOCKET_EVENTS=true
FEATURE_AUDIT_LOGGING=true
FEATURE_RISK_MONITORING=true
FEATURE_BACKGROUND_WORKERS=true

# ============================================================================
# MAINTENANCE MODE
# ============================================================================
MAINTENANCE_MODE=false
MAINTENANCE_MESSAGE="TradeSense AI is currently under maintenance. Please try again later."

# ============================================================================
# BACKUP CONFIGURATION
# ============================================================================
BACKUP_ENABLED=false
BACKUP_SCHEDULE=0 2 * * *
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=tradesense-backups

# ============================================================================
# NOTIFICATION CONFIGURATION
# ============================================================================
EMAIL_NOTIFICATIONS=false
SLACK_NOTIFICATIONS=false
WEBHOOK_NOTIFICATIONS=false

# ============================================================================
# API RATE LIMITING
# ============================================================================
API_RATE_LIMIT_PER_MINUTE=60
API_RATE_LIMIT_PER_HOUR=1000
API_RATE_LIMIT_PER_DAY=10000

# ============================================================================
# CACHE CONFIGURATION
# ============================================================================
CACHE_DEFAULT_TTL=3600
CACHE_MAX_KEYS=10000
CACHE_EVICTION_POLICY=lru

# ============================================================================
# END OF CONFIGURATION
# ============================================================================
# For security:
# 1. Change all default passwords and keys
# 2. Use environment-specific values for production
# 3. Never commit real secrets to version control
# 4. Use Docker secrets or external secret management for production
#
# For development:
# 1. Copy this file to .env
# 2. Adjust values for your local environment
# 3. Run: docker-compose up -d
#
# For production:
# 1. Use strong, unique passwords and keys
# 2. Enable SSL/HTTPS
# 3. Configure proper logging and monitoring
# 4. Set up regular backups
# ============================================================================
